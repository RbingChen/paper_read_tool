<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>OneRecæŠ€æœ¯æŠ¥å‘Šåˆ†æ</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    body { font-family: Arial, sans-serif; line-height: 1.6; }
    .original { background-color: #f0f0f0; border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; }
    .translated { background-color: #e0ffe0; border: 1px solid #a0cca0; padding: 15px; margin-bottom: 30px; }
    .formula-container { background-color: #ffffe0; padding: 20px; text-align: center; margin: 25px 0; }
    .formula-number { font-style: italic; margin-top: 5px; }
    .term { color: red; font-weight: bold; }
    h2 { border-bottom: 2px solid #ddd; padding-bottom: 8px; }
    section { margin-bottom: 40px; }
  </style>
</head>
<body>
  <h1>OneRecæŠ€æœ¯æŠ¥å‘Šåˆ†æ</h1>
  
  <!-- å†…å®¹ç†è§£ -->
  <section id="understanding">
    <h2>å†…å®¹ç†è§£</h2>
    <p>è¯¥æ–‡æœ¬ä¸»è¦æè¿°OneRecæ¨èç³»ç»Ÿæ¡†æ¶çš„ä¸¤é¡¹å…³é”®æŠ€æœ¯æ”¹è¿›ï¼š</p>
    <ol>
      <li><strong>æ ¼å¼å¥–åŠ±å¼ºåŒ–å­¦ä¹ </strong>ï¼šè§£å†³åˆæ³•/éæ³•ä»¤ç‰Œ(logits)æŒ¤å‹é—®é¢˜ï¼Œé€šè¿‡è®¾ç½®å¥–åŠ±æœºåˆ¶å¼•å¯¼æ¨¡å‹ç”Ÿæˆåˆæ³•è¾“å‡º</li>
      <li><strong>å·¥ä¸šåœºæ™¯å¯¹é½</strong>ï¼šé€šè¿‡ç«¯åˆ°ç«¯å¼ºåŒ–å­¦ä¹ ç»Ÿä¸€ä¼˜åŒ–å¤šç›®æ ‡éœ€æ±‚ï¼ˆç”¨æˆ·åå¥½ã€å•†ä¸šåŒ–ã€å†·å¯åŠ¨ç­‰ï¼‰</li>
      <li><strong>è®­ç»ƒåŸºç¡€è®¾æ–½</strong>ï¼šè¯¦ç»†è¯´æ˜æ”¯æ’‘å¤§è§„æ¨¡é¢„è®­ç»ƒçš„ç¡¬ä»¶æ¶æ„ï¼ˆ90æœåŠ¡å™¨é›†ç¾¤ã€NVLinkäº’è”ã€RDMAç½‘ç»œç­‰ï¼‰å’Œä¼˜åŒ–æŠ€æœ¯</li>
    </ol>
    <p>æ ¸å¿ƒåˆ›æ–°ç‚¹åœ¨äºå°†ä¼ ç»Ÿæ¨èç³»ç»Ÿçš„å¤šé˜¶æ®µä¼˜åŒ–æ•´åˆåˆ°ç»Ÿä¸€çš„å¼ºåŒ–å­¦ä¹ æ¡†æ¶ä¸­ï¼Œé€šè¿‡å¥–åŠ±å‡½æ•°è®¾è®¡å®ç°ç«¯åˆ°ç«¯çš„å·¥ä¸šåœºæ™¯é€‚é…ã€‚</p>
  </section>
  
  <!-- å†…å®¹ç¿»è¯‘ -->
  <section id="translation">
    <h2>å†…å®¹ç¿»è¯‘</h2>
    
    <div class="original">
      <p>OneRec Technical Report of some legal tokens being squeezed to levels comparable to those of illegal tokens, making it difficult for the model to distinguish legal tokens.</p>
    </div>
    <div class="translated">
      <p>OneRecæŠ€æœ¯æŠ¥å‘Šä¸­æŒ‡å‡ºï¼ŒæŸäº›<strong class="term">åˆæ³•ä»¤ç‰Œ(legal tokens)</strong>è¢«æŒ¤å‹åˆ°ä¸<strong class="term">éæ³•ä»¤ç‰Œ(illegal tokens)</strong>ç›¸å½“çš„æ°´å¹³ï¼Œå¯¼è‡´æ¨¡å‹éš¾ä»¥åŒºåˆ†åˆæ³•ä»¤ç‰Œã€‚</p>
    </div>
    
    <div class="original">
      <p>To address this issue, we propose incorporating a <strong>format reward</strong> in reinforcement learning to encourage the model's legal generation. Specifically, we randomly select ğ¾ samples from the ğº samples for legality reinforcement learning. For legal samples, we set the advantage to 1, and for illegal samples, we discard them directly to avoid the squeezing effect.</p>
    </div>
    <div class="translated">
      <p>ä¸ºè§£å†³æ­¤é—®é¢˜ï¼Œæˆ‘ä»¬æå‡ºåœ¨<strong class="term">å¼ºåŒ–å­¦ä¹ (reinforcement learning)</strong>ä¸­å¼•å…¥<strong class="term">æ ¼å¼å¥–åŠ±(format reward)</strong>ä»¥é¼“åŠ±æ¨¡å‹ç”Ÿæˆåˆæ³•è¾“å‡ºã€‚å…·ä½“è€Œè¨€ï¼Œæˆ‘ä»¬ä»ğºä¸ªæ ·æœ¬ä¸­éšæœºé€‰æ‹©ğ¾ä¸ªæ ·æœ¬è¿›è¡Œåˆæ³•æ€§å¼ºåŒ–å­¦ä¹ ã€‚å¯¹åˆæ³•æ ·æœ¬è®¾ç½®<strong class="term">ä¼˜åŠ¿å€¼(advantage)</strong>ä¸º1ï¼Œéæ³•æ ·æœ¬ç›´æ¥ä¸¢å¼ƒä»¥é¿å…æŒ¤å‹æ•ˆåº”ã€‚</p>
    </div>
    
    <div class="formula-container">
      <div class="math-equation">
        \[ A_i = \begin{cases} 
        1 & \text{if } o_i \in I_{\text{legal}} \\ 
        0 & \text{if } o_i \notin I_{\text{legal}} 
        \end{cases} \quad (32) \]
      </div>
      <div class="formula-number">å…¬å¼(32)ï¼šåˆæ³•æ€§ä¼˜åŠ¿å‡½æ•°å®šä¹‰</div>
    </div>
    
    <div class="original">
      <p>The optimization objective formulation is the same as the <strong>ECPO</strong> (Equation 29) and we directly use ğ´ğ‘– as advantages.</p>
    </div>
    <div class="translated">
      <p>ä¼˜åŒ–ç›®æ ‡å…¬å¼ä¸<strong class="term">ECPOç®—æ³•(ECPO)</strong>ï¼ˆå…¬å¼29ï¼‰ç›¸åŒï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ğ´ğ‘–ä½œä¸ºä¼˜åŠ¿å€¼ã€‚</p>
    </div>
    
    <div class="original">
      <h3>2.4.3. Industrial Scenario Alignment</h3>
      <p>In industrial scenarios, the recommendation system needs to consider not only user preferences but also various other aspects. For example, at Kuaishou, the ecosystem of the video community, commercialization needs, and the delivery of cold-start and long-tail videos. Traditional recommendation systems attempt to address these issues by applying algorithms or strategies at one stage of the recommendation pipeline. Due to inconsistencies across different stages, this can easily lead to a recurring cycle of unexpected problems emerging alternately. Engineers are forced to constantly make adjustments through patching, resulting in a bloated system over time that hinders iteration.</p>
    </div>
    <div class="translated">
      <h3>2.4.3. å·¥ä¸šåœºæ™¯å¯¹é½</h3>
      <p>åœ¨å·¥ä¸šåœºæ™¯ä¸­ï¼Œæ¨èç³»ç»Ÿä¸ä»…éœ€è€ƒè™‘ç”¨æˆ·åå¥½ï¼Œè¿˜éœ€å…¼é¡¾å¤šæ–¹é¢å› ç´ ã€‚ä¾‹å¦‚åœ¨å¿«æ‰‹å¹³å°ï¼Œéœ€å¹³è¡¡è§†é¢‘ç¤¾åŒºç”Ÿæ€ã€å•†ä¸šåŒ–éœ€æ±‚ä»¥åŠå†·å¯åŠ¨å’Œé•¿å°¾è§†é¢‘çš„åˆ†å‘ã€‚ä¼ ç»Ÿæ¨èç³»ç»Ÿè¯•å›¾åœ¨æ¨èæµç¨‹çš„å•ä¸€é˜¶æ®µåº”ç”¨ç®—æ³•æˆ–ç­–ç•¥è§£å†³è¿™äº›é—®é¢˜ã€‚ç”±äºä¸åŒé˜¶æ®µçš„ä¸ä¸€è‡´æ€§ï¼Œå®¹æ˜“å¯¼è‡´æ„å¤–é—®é¢˜äº¤æ›¿å‡ºç°çš„å¾ªç¯ã€‚å·¥ç¨‹å¸ˆè¢«è¿«é€šè¿‡æ‰“è¡¥ä¸ä¸æ–­è°ƒæ•´ï¼Œé•¿æœŸå¯¼è‡´ç³»ç»Ÿè‡ƒè‚¿å¹¶é˜»ç¢è¿­ä»£ã€‚</p>
    </div>
    
    <div class="original">
      <p>In OneRec, we only need to incorporate optimization objectives into the reward system and adopt reinforcement learning to perform targeted optimization. This approach is not only convenient but also allows for end-to-end implementation, maintaining system consistency. We will provide an example of optimization practice in Section 4.3.3.</p>
    </div>
    <div class="translated">
      <p>åœ¨<strong class="term">OneRecæ¡†æ¶(OneRec)</strong>ä¸­ï¼Œæˆ‘ä»¬åªéœ€å°†ä¼˜åŒ–ç›®æ ‡æ•´åˆåˆ°å¥–åŠ±ç³»ç»Ÿä¸­ï¼Œå¹¶é‡‡ç”¨<strong class="term">å¼ºåŒ–å­¦ä¹ (reinforcement learning)</strong>è¿›è¡Œé’ˆå¯¹æ€§ä¼˜åŒ–ã€‚è¯¥æ–¹æ³•ä¸ä»…ä¾¿æ·ï¼Œè¿˜èƒ½å®ç°ç«¯åˆ°ç«¯éƒ¨ç½²ï¼Œä¿æŒç³»ç»Ÿä¸€è‡´æ€§ã€‚æˆ‘ä»¬å°†åœ¨ç¬¬4.3.3èŠ‚æä¾›ä¼˜åŒ–å®è·µç¤ºä¾‹ã€‚</p>
    </div>
    
    <div class="original">
      <h3>3. Training Framework</h3>
      <h4>3.1. Training Infrastructure</h4>
      <p>In this section, we describe our hardware and infrastructure that facilitated the large-scale pre-training of OneRec and introduce several optimizations that enhance training efficiency.</p>
    </div>
    <div class="translated">
      <h3>3. è®­ç»ƒæ¡†æ¶</h3>
      <h4>3.1. è®­ç»ƒåŸºç¡€è®¾æ–½</h4>
      <p>æœ¬èŠ‚æè¿°æ”¯æŒOneRecå¤§è§„æ¨¡é¢„è®­ç»ƒçš„ç¡¬ä»¶åŸºç¡€è®¾æ–½ï¼Œå¹¶ä»‹ç»æå‡è®­ç»ƒæ•ˆç‡çš„è‹¥å¹²ä¼˜åŒ–æŠ€æœ¯ã€‚</p>
    </div>
    
    <div class="original">
      <p><strong>Compute.</strong> We utilize 90 servers for training, each equipped with 8 flagship GPUs and 2 CPUs interconnected via 400Gbps NVLink to ensure high-speed intra-node bandwidth.</p>
    </div>
    <div class="translated">
      <p><strong>è®¡ç®—èµ„æºï¼š</strong> ä½¿ç”¨90å°æœåŠ¡å™¨ï¼Œæ¯å°é…å¤‡8å—æ——èˆ°GPUå’Œ2ä¸ªCPUï¼Œé€šè¿‡400Gbps <strong class="term">NVLinkäº’è”(NVLink)</strong>ç¡®ä¿èŠ‚ç‚¹å†…é«˜é€Ÿå¸¦å®½ã€‚</p>
    </div>
    
    <div class="original">
      <p><strong>Networking.</strong> Intra-node communication is managed by the efficient NVLink network, while inter-node communication is supported by 400Gbps RDMA for training traffic and 100Gbps TCP for training data and embedding prefetching operations.</p>
    </div>
    <div class="translated">
      <p><strong>ç½‘ç»œæ¶æ„ï¼š</strong> èŠ‚ç‚¹å†…é€šä¿¡ç”±é«˜æ•ˆNVLinkç½‘ç»œç®¡ç†ï¼ŒèŠ‚ç‚¹é—´é€šä¿¡é‡‡ç”¨400Gbps <strong class="term">RDMAåè®®(RDMA)</strong>å¤„ç†è®­ç»ƒæµé‡ï¼Œ100Gbps TCPå¤„ç†è®­ç»ƒæ•°æ®å’Œ<strong class="term">åµŒå…¥é¢„å–(embedding prefetching)</strong>æ“ä½œã€‚</p>
    </div>
    
    <div class="original">
      <p><strong>Storage.</strong> Each server is equipped with 4 NVMe SSDs to expedite checkpoint writes, allowing for the storage of large-scale embedding parameters and dense parameters in HDFS with minimal downtime for fault tolerance.</p>
    </div>
    <div class="translated">
      <p><strong>å­˜å‚¨ç³»ç»Ÿï¼š</strong> æ¯å°æœåŠ¡å™¨é…å¤‡4å—NVMe SSDåŠ é€Ÿæ£€æŸ¥ç‚¹å†™å…¥ï¼Œå¤§è§„æ¨¡<strong class="term">åµŒå…¥å‚æ•°(embedding parameters)</strong>å’Œç¨ å¯†å‚æ•°å­˜å‚¨åœ¨<strong class="term">HDFSåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ(HDFS)</strong>ä¸­ï¼Œå®ç°æœ€å°åŒ–æ•…éšœå®¹å¿åœæœºæ—¶é—´ã€‚</p>
    </div>
    
    <div class="original">
      <p><strong>Training Acceleration.</strong> For training acceleration, several core optimizations are implemented: 1) Embedding Acceleration: To manage the extensive embedding workload beyond CPU capacity, we utilize Kuaishouâ€™s SKAI framework for GPU-based parameter servers. This framework leverages cross-GPU unified embedding tables, GPU caching paradigms, and prefetching pipelines to enhance training efficiency and reduce management overhead.</p>
    </div>
    <div class="translated">
      <p><strong>è®­ç»ƒåŠ é€Ÿï¼š</strong> å®æ–½çš„æ ¸å¿ƒä¼˜åŒ–åŒ…æ‹¬ï¼š1) <strong class="term">åµŒå…¥åŠ é€Ÿ(Embedding Acceleration)</strong>ï¼šä¸ºå¤„ç†è¶…å‡ºCPUèƒ½åŠ›çš„åµŒå…¥å·¥ä½œè´Ÿè½½ï¼Œé‡‡ç”¨å¿«æ‰‹<strong class="term">SKAIæ¡†æ¶(SKAI framework)</strong>æ„å»ºåŸºäºGPUçš„å‚æ•°æœåŠ¡å™¨ã€‚è¯¥æ¡†æ¶åˆ©ç”¨è·¨GPUç»Ÿä¸€åµŒå…¥è¡¨ã€GPUç¼“å­˜èŒƒå¼å’Œé¢„å–æµæ°´çº¿æå‡è®­ç»ƒæ•ˆç‡å¹¶é™ä½ç®¡ç†å¼€é”€ã€‚</p>
    </div>
  </section>
  
  <!-- æ‘˜è¦æ€»ç»“ -->
  <section id="summary">
    <h2>æ‘˜è¦æ€»ç»“</h2>
    <p>æœ¬æŠ€æœ¯æŠ¥å‘Šé˜è¿°äº†OneRecæ¨èç³»ç»Ÿçš„ä¸‰å¤§æ ¸å¿ƒåˆ›æ–°ï¼š</p>
    <ul>
      <li><strong>æ ¼å¼å¥–åŠ±æœºåˆ¶</strong>ï¼šé€šè¿‡å¼ºåŒ–å­¦ä¹ å¼•å…¥åˆæ³•æ€§å¥–åŠ±å‡½æ•°ï¼ˆå…¬å¼32ï¼‰ï¼Œè§£å†³åˆæ³•/éæ³•ä»¤ç‰Œçš„logitsæŒ¤å‹é—®é¢˜</li>
      <li><strong>ç«¯åˆ°ç«¯å·¥ä¸šå¯¹é½</strong>ï¼šå°†å¤šç›®æ ‡ä¼˜åŒ–ï¼ˆç”¨æˆ·åå¥½/å•†ä¸šåŒ–/å†·å¯åŠ¨ï¼‰ç»Ÿä¸€æ•´åˆåˆ°å¼ºåŒ–å­¦ä¹ å¥–åŠ±ç³»ç»Ÿï¼Œé¿å…ä¼ ç»Ÿå¤šé˜¶æ®µç³»ç»Ÿçš„ç¢ç‰‡åŒ–é—®é¢˜</li>
      <li><strong>é«˜æ€§èƒ½è®­ç»ƒæ¶æ„</strong>ï¼šåŸºäº90æœåŠ¡å™¨é›†ç¾¤ï¼ˆNVLink+RDMAï¼‰ï¼Œé‡‡ç”¨SKAIæ¡†æ¶å®ç°åµŒå…¥åŠ é€Ÿï¼Œæ”¯æŒä¸‡äº¿çº§å‚æ•°é¢„è®­ç»ƒ</li>
    </ul>
    <p>å…³é”®æŠ€æœ¯çªç ´åœ¨äºé€šè¿‡ç»Ÿä¸€çš„å¼ºåŒ–å­¦ä¹ èŒƒå¼ï¼Œå®ç°å·¥ä¸šçº§æ¨èç³»ç»Ÿçš„å¤šç›®æ ‡ååŒä¼˜åŒ–å’ŒåŸºç¡€è®¾æ–½é«˜æ•ˆæ‰©å±•ã€‚</p>
  </section>
  
  <!-- æœ¯è¯­è¯†åˆ« -->
  <section id="terms">
    <h2>æœ¯è¯­è§£é‡Š</h2>
    <ul>
      <li><strong class="term">åˆæ³•ä»¤ç‰Œ/éæ³•ä»¤ç‰Œ(legal/illegal tokens)</strong>ï¼šåœ¨åºåˆ—ç”Ÿæˆä¸­ç¬¦åˆ/è¿åé¢„è®¾æ ¼å¼è§„åˆ™çš„è¾“å‡ºå•å…ƒã€‚å½“ä¸¤è€…logitså€¼ç›¸è¿‘æ—¶ä¼šå¯¼è‡´æ¨¡å‹å†³ç­–æ··æ·†</li>
      <li><strong class="term">æ ¼å¼å¥–åŠ±(format reward)</strong>ï¼šå¼ºåŒ–å­¦ä¹ ä¸­é’ˆå¯¹è¾“å‡ºç»“æ„åˆè§„æ€§è®¾è®¡çš„å¥–åŠ±ä¿¡å·ï¼Œå¼•å¯¼æ¨¡å‹ç”Ÿæˆåˆæ³•åºåˆ—</li>
      <li><strong class="term">ä¼˜åŠ¿å€¼(advantage)</strong>ï¼šåœ¨ç­–ç•¥æ¢¯åº¦ç®—æ³•ä¸­è¡¡é‡ç‰¹å®šåŠ¨ä½œä¼˜äºå¹³å‡æ°´å¹³çš„ç¨‹åº¦ï¼Œæ­¤å¤„ç”¨äºåˆæ³•æ€§å¥–åŠ±ï¼ˆA_i=1è¡¨ç¤ºåˆæ³•ï¼‰</li>
      <li><strong class="term">ECPOç®—æ³•(ECPO)</strong>ï¼šOneRecé‡‡ç”¨çš„å¼ºåŒ–å­¦ä¹ ä¼˜åŒ–ç›®æ ‡ï¼ˆå…¬å¼29ï¼‰ï¼Œå…·ä½“æŒ‡ä»£æœªåœ¨ç‰‡æ®µä¸­å±•å¼€çš„ç®—æ³•</li>
      <li><strong class="term">NVLinkäº’è”(NVLink)</strong>ï¼šNVIDIAå¼€å‘çš„GPUé«˜é€Ÿç›´è¿æŠ€æœ¯ï¼ˆ400Gbpsï¼‰ï¼Œå¤§å¹…æå‡è®¾å¤‡é—´æ•°æ®ä¼ è¾“æ•ˆç‡</li>
      <li><strong class="term">RDMAåè®®(RDMA)</strong>ï¼šè¿œç¨‹ç›´æ¥å†…å­˜è®¿é—®æŠ€æœ¯ï¼Œç»•è¿‡CPUå®ç°ç½‘ç»œèŠ‚ç‚¹é—´è¶…ä½å»¶è¿Ÿæ•°æ®ä¼ è¾“</li>
      <li><strong class="term">åµŒå…¥å‚æ•°(embedding parameters)</strong>ï¼šæ¨èç³»ç»Ÿä¸­å°†ç¦»æ•£ç‰¹å¾æ˜ å°„ä¸ºç¨ å¯†å‘é‡çš„å¯å­¦ä¹ å‚æ•°çŸ©é˜µ</li>
      <li><strong class="term">SKAIæ¡†æ¶(SKAI framework)</strong>ï¼šå¿«æ‰‹å¼€å‘çš„GPUå‚æ•°æœåŠ¡å™¨ç³»ç»Ÿï¼Œé€šè¿‡ç»Ÿä¸€å†…å­˜ç®¡ç†å’Œé¢„å–æœºåˆ¶ä¼˜åŒ–åµŒå…¥è®­ç»ƒ</li>
    </ul>
  </section>
</body>
</html>